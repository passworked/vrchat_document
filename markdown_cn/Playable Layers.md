# Playable Layers
当您为 VRChat 头像创建动画时，您将使用 VRChat 的“可播放图层”。它们允许您将您可能想用头像做的一些事情干净地分离到它们自己的动画中 - 例如奔跑、跳跃、竖起大拇指、微笑、摇尾巴以及这些的组合。
#### 需要 Unity 知识
本文档的编写假设您对 [Unity Animator](https://docs.unity3d.com/2022.3/Documentation/Manual/class-AnimatorController.html)有一定的了解。
在 Avatars 3.0 Avatar Descriptor 中，所有人型 Avatar 都有五个按钮：
- Base
- Additive
- Gesture
- Action
- FX
通用头像只有三个按钮：
- Base
- Action
- FX
这些是 Playable Layers。每个层级都是一个Unity动画控制机，并且它们彼此重叠。换句话说，您有 5 个根 Animator 可供使用，每个 Animator 都可以有多个 Animator Layers。

这些图层按顺序应用——换句话说，先是 Base，然后是 Additive，然后是 Gesture、Action、FX。例如，如果 Additive 中的某个内容为骨骼（权重为 1.0）制作动画，然后 Action 中的某个内容为同一骨骼（权重为 1.0）制作动画，则 Action 动画将覆盖之前的变换。

我们在 SDK 中提供了示例可播放图层。根据你学习和迭代事物的方式，使用和编辑这些默认图层可能更容易解决问题！

当您运行 VRChat 并佩戴（或查看）Avatar 3.0 头像时，所有这些可播放图层都会组合到一个组合的 Animator 中。此 Animator 是您的头像的根、主要动画机，您可以控制它的任何部分。 这意味着没有理由在您的头像上添加任何其他动画机。

顺便说一句，你永远不应该在多个 Playable Layer 中使用相同的控制器。这可能适用于某些设置，但这是一种非常糟糕的做法，并且会在扩展头像的功能时导致重大问题。

#### 仅使用动画控制器
我们只支持在 Playable Layer 插槽中使用 Animation Controller。请勿使用任何其他类型的控制器 - 您将遇到错误或无法上传内容。

这些 Playable Layers 有什么作用？这是简短的版本：
| 图层名  | 作用 |
|:--------|:-----|
| Base    | 始终播放、响应移动（如移动中的动作）、或响应头像运动状态（如奔跑、下落、蹲伏等）。仅限变换动画。 |
| Additive | 在 Base 图层基础上“叠加”的动画，例如呼吸动画。仅限变换动画。 |
| Gesture | 通过手势或表达式菜单触发的内容，也可以用来设置“待机动画”，如尾巴摇动、翅膀拍动或耳朵移动。仅限变换动画。 |
| Action  | 完全覆盖的动画，类似于 AV2 的表情动作。仅限变换动画。 |
| FX      | 与 Gesture 类似，但用于非变换（位置、旋转、缩放）相关的动画效果。 |

这很好，但让我们更详细地了解一下。
### Base层
Base 图层包含运动动画，包括用于行走、跑步、平移的混合树。它还包括跳跃、坠落、快速坠落、蹲伏和爬行等的动画状态。

请记住，如果您在此处放置某些内容，则必须重新定义您的运动动画状态。这很复杂！查看 Base Playable Layer 示例，了解它有多复杂。

Base 中的动画应仅影响变换，并且所有图层都应使用 Avatar Masks 以确保您只影响适当的变换。

### Additive层
Additive 图层用于在 Base 中进行动画处理的人形骨骼之上的叠加变换运动，例如可以“添加”到 Base 图层的呼吸动画。

如果您想将空闲动画添加到非人形骨骼（如尾巴、耳朵等）中，请改用 Gesture（手势）！Additive 专门用于人形骨骼。

Additive 图层很特殊，因为它始终设置为 “Additive” 混合。简而言之，如果你有一个在运动过程中移动的变换，则 Additive 动画会将其动画 “添加” 在顶部。如果你在 Additive 中对骨骼做疯狂的事情，这可能会非常奇怪，所以尽量把它保持得非常小。

#### 忽略 Additive层第一层的Avatar Mask
第一层（基础层、第 0 层等）的 Avatar Mask 将被忽略。这是为了内部遮罩目的。您仍然可以蒙版其他图层，但您应用于第一个图层的任何蒙版都将被忽略。
Additive 中的动画应只有变换动画。
### Gesture
Gesture 图层适用于需要作用于各个身体部位，同时仍为身体其余部分播放基础动画的动画。有点像 AV2 手势，但适用于身体的任何部位。

利用 Avatar Masking 确保动画只影响您想要制作动画的 Avatar 部分！因此，如果您希望手势参数仅为左手/右手制作手形，则需要在每个图层上屏蔽这些手部。

此外，如果您想为非人形骨骼（如尾巴、翅膀、耳朵等）制作“空闲”动画，您应该将它放在 Gesture 中。

Gesture 中的动画应仅影响转换。
### Action
Action 层用于骨骼动画，当您需要完全控制角色时，它将覆盖所有其他层。基本上，想想 AV2 的“表情”。

默认情况下，此图层混合为零。 在作图层中执行任何作之前，您需要使用[Playable Layer Control State Behavior](https://creators.vrchat.com/avatars/state-behaviors#playable-layer-control)将此图层混合在一起，然后再过渡到您正在执行的实际作！完成后确保将其混合回零。

Action 中的动画应仅影响转换。

### FX
FX 是一个特殊层。 在所有其他图层上，您不应使用材质动画、着色器属性动画或混合变形动画，因为它们不会复制到镜像克隆。只有转换才是。

但是，在 FX 层中，所有内容都被复制了！换句话说， 所有不是人形变换/肌肉动画的内容都应该进入 FX 层。 这包括（但不限于）启用/禁用游戏对象、组件、材质交换、着色器动画、粒子系统动画等。

默认情况下，第一个 FX 图层中的遮罩为空，这将（在 avatar 初始化时）创建一个默认遮罩，该遮罩将禁用所有人形肌肉，但启用所有游戏对象动画。这意味着层次结构中的任何动画都应该可以正常工作，尽管仍然不建议在此处对转换进行动画处理。



如果您的手势中有非肌肉动画（例如，您的手势遮罩在底部选中了任何变换），则必须在 FX 遮罩中禁用这些相同的变换。这将允许您的 Gesture 动画 透过 FX 图层。
#### 例子
假设您的头像具有以下设置：
- 您的头像上有一条尾巴（不属于人形层次结构的骨骼链）。
- 尾部的 Gesture Animator 图层具有一个特殊蒙版，其中仅启用了骨骼链。
- 具有“all-parts mask”的另一个 Gesture Animator 图层也选中了这些骨骼（以及控制器其余部分中的其他身体部位）。

在这种情况下，您还需要在第一个 FX 图层中创建自定义蒙版。这将遮罩所有肌肉（人体图全红色）并遮罩尾巴中的所有骨骼。您还需要确保此遮罩具有您将为 FX 制作动画的组件的任何转换的复选框。例如，用于为混合形状或材质设置动画的实体蒙皮网格。

请注意，如果层次结构中有一个游戏对象同时具有动画变换（在 Gesture 中）和动画效果组件（在 FX 中），则这不适用于蒙版的要求。如果您在层次结构中嵌入了一个简单的静态网格，并且您正在 Gesture 中对其进行动画处理，但也在 FX 中应用了材质更改，则可能会发生这种情况。另一个示例是将粒子效果组件直接放在上面的示例尾部骨骼上。简单的解决方法是创建一个子游戏对象，并在其上放置静态网格或效果。您不会对子对象的变换进行动画处理，而只会对父对象的变换进行动画处理。如果您遵循这些步骤，则无需将变换动画放入 FX 图层中。